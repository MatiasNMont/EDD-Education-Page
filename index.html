<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pedidos - Arquitectura Orientada a Eventos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .pattern-selector {
            text-align: center;
            margin-bottom: 20px;
        }

        .pattern-toggle {
            display: inline-flex;
            background: white;
            border-radius: 50px;
            padding: 5px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .pattern-toggle button {
            padding: 12px 30px;
            border: none;
            background: transparent;
            color: #666;
            font-size: 1em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .pattern-toggle button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.5);
        }

        .pattern-toggle button:hover:not(.active) {
            color: #667eea;
        }


        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 20px;
            margin-bottom: 20px;
            align-items: start;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .panel h2 {
            color: #667eea;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .order-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        input, select {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .event-log {
            height: 400px;
            overflow-y: auto;
            border: 2px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            background: #f9f9f9;
        }

        .event-item {
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 5px;
            border-left: 4px solid;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .event-item.info {
            background: #e3f2fd;
            border-color: #2196F3;
        }

        .event-item.success {
            background: #e8f5e9;
            border-color: #4CAF50;
        }

        .event-item.error {
            background: #ffebee;
            border-color: #f44336;
        }

        .event-item.warning {
            background: #fff3e0;
            border-color: #ff9800;
        }

        .event-time {
            font-size: 0.8em;
            color: #666;
            margin-right: 10px;
        }

        .event-type {
            font-weight: bold;
            margin-right: 10px;
        }

        .kafka-terminals {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .terminal {
            background: #1e1e1e;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            font-family: 'Courier New', monospace;
            min-height: 350px;
        }

        .terminal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #333;
        }

        .terminal-title {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #4ec9b0;
            font-weight: bold;
            font-size: 14px;
        }

        .terminal-buttons {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .terminal-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .terminal-btn.close { background: #ff5f56; }
        .terminal-btn.minimize { background: #ffbd2e; }
        .terminal-btn.maximize { background: #27c93f; }

        .terminal-clear-btn {
            background: rgba(78, 201, 176, 0.2);
            border: 1px solid #4ec9b0;
            color: #4ec9b0;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Courier New', monospace;
            margin-left: 10px;
        }

        .terminal-clear-btn:hover {
            background: rgba(78, 201, 176, 0.3);
            transform: translateY(-1px);
        }

        .terminal-clear-btn:active {
            transform: translateY(0);
        }

        .fullscreen-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(102, 126, 234, 0.9);
            border: 2px solid white;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
        }

        .fullscreen-btn:hover {
            background: rgba(102, 126, 234, 1);
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 15px;
            width: 95%;
            height: 95%;
            position: relative;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ff5f56;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        .modal-close:hover {
            background: #ff3b30;
            transform: rotate(90deg) scale(1.1);
        }

        .modal-svg {
            width: 100%;
            height: calc(100% - 60px);
            margin-top: 40px;
        }

        .diagram-container {
            position: relative;
        }

        .terminal-content {
            height: 280px;
            overflow-y: auto;
            font-size: 12px;
            line-height: 1.6;
            color: #d4d4d4;
        }

        .terminal-content::-webkit-scrollbar {
            width: 8px;
        }

        .terminal-content::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        .terminal-content::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 4px;
        }

        .terminal-line {
            margin-bottom: 4px;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .terminal-timestamp {
            color: #858585;
            margin-right: 8px;
        }

        .terminal-topic {
            color: #4ec9b0;
            font-weight: bold;
        }

        .terminal-partition {
            color: #ce9178;
        }

        .terminal-key {
            color: #9cdcfe;
        }

        .terminal-producer {
            color: #569cd6;
        }

        .terminal-consumer {
            color: #4ec9b0;
        }

        .terminal-event {
            color: #dcdcaa;
        }

        .terminal-data {
            color: #b5cea8;
            margin-left: 20px;
            font-size: 11px;
        }

        .terminal-arrow {
            color: #d16969;
            margin: 0 8px;
        }

        @media (max-width: 1200px) {
            .kafka-terminals {
                grid-template-columns: 1fr;
            }
        }

        .services-status {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .service-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #ddd;
            transition: transform 0.2s;
        }

        .service-card:hover {
            transform: scale(1.05);
        }

        .service-card h3 {
            color: #333;
            margin-bottom: 10px;
        }

        .service-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>üè™ Sistema de Pedidos - Arquitectura Orientada a Eventos</h1>

        <div class="pattern-selector">
            <div class="pattern-toggle">
                <button id="orchestrationBtn" class="active">üéØ Orquestaci√≥n</button>
                <button id="choreographyBtn">üíÉ Coreograf√≠a</button>
            </div>
        </div>

        <div class="main-content">
            <div class="panel">
                <h2>üìù Nuevo Pedido</h2>
                <form class="order-form" id="orderForm">
                    <div class="form-group">
                        <label for="customerName">Nombre del Cliente:</label>
                        <input type="text" id="customerName" required>
                    </div>

                    <div class="form-group">
                        <label for="product">Producto:</label>
                        <select id="product" required>
                            <option value="">Selecciona un producto</option>
                            <option value="laptop">Laptop - $1200</option>
                            <option value="smartphone">Smartphone - $800</option>
                            <option value="tablet">Tablet - $500</option>
                            <option value="headphones">Aud√≠fonos - $150</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="quantity">Cantidad:</label>
                        <input type="number" id="quantity" min="1" max="10" value="1" required>
                    </div>

                    <div class="form-group">
                        <label for="address">Direcci√≥n de Env√≠o:</label>
                        <input type="text" id="address" required>
                    </div>

                    <button type="submit">üöÄ Procesar Pedido</button>
                </form>
            </div>

            <div class="panel diagram-container">
                <button class="fullscreen-btn" id="fullscreenBtn">
                    <span>üîç</span>
                    <span>Pantalla Completa</span>
                </button>
                <h2 id="diagramTitle">üîÑ Arquitectura con Kafka - T√≥picos y Particiones</h2>
                <svg id="architectureDiagram" viewBox="0 0 1200 650" style="width: 100%; height: 650px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 5px; border: 3px solid #667eea;">
                    <defs>
                        <filter id="glow">
                            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                            <feMerge>
                                <feMergeNode in="coloredBlur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>
                        <filter id="shadow">
                            <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.3"/>
                        </filter>
                        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#999" />
                        </marker>
                        <marker id="arrowheadBi" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                            <polygon points="0 0, 10 3, 0 6" fill="#51cf66" />
                        </marker>

                        <!-- Icono de sobre/mensaje -->
                        <g id="envelopeIcon">
                            <rect x="-8" y="-6" width="16" height="12" rx="1" fill="white" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M -8 -6 L 0 0 L 8 -6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
                            <line x1="-8" y1="6" x2="-2" y2="0" stroke="currentColor" stroke-width="1.5"/>
                            <line x1="8" y1="6" x2="2" y2="0" stroke="currentColor" stroke-width="1.5"/>
                        </g>

                        <!-- Gradientes para microservicios -->
                        <linearGradient id="gradInventory" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#51cf66;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#2f9e44;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="gradPayment" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#4dabf7;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#1971c2;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="gradShipping" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#9775fa;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#6741d9;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="gradNotification" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff8787;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#fa5252;stop-opacity:1" />
                        </linearGradient>
                        <linearGradient id="gradOrchestrator" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#ff6b6b;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#c92a2a;stop-opacity:1" />
                        </linearGradient>
                    </defs>

                    <!-- Capa de trazas (debajo de todo) -->
                    <g id="traceLayer"></g>

                    <!-- Orquestador (solo visible en modo Orquestaci√≥n) -->
                    <g id="orchestrator" filter="url(#shadow)">
                        <rect x="500" y="15" width="200" height="80" rx="12" fill="url(#gradOrchestrator)" stroke="white" stroke-width="2"/>
                        <circle cx="530" cy="55" r="18" fill="white" opacity="0.3"/>
                        <text x="530" y="62" text-anchor="middle" fill="white" font-size="22">üéØ</text>
                        <text x="620" y="50" text-anchor="middle" fill="white" font-size="16" font-weight="bold">Orquestador</text>
                        <text x="620" y="70" text-anchor="middle" fill="white" font-size="11" opacity="0.9">Saga Coordinator</text>
                    </g>

                    <!-- Kafka Cluster Central -->
                    <g id="kafkaCluster">
                        <rect x="400" y="130" width="400" height="280" rx="15" fill="#2c2c2c" stroke="#667eea" stroke-width="4"/>
                        <text x="600" y="160" text-anchor="middle" fill="#ffd700" font-size="18" font-weight="bold">Apache Kafka Cluster</text>

                        <!-- Topic: Orders -->
                        <g id="ordersTopicGroup">
                            <rect x="420" y="180" width="170" height="100" rx="8" fill="#3a3a3a" stroke="#51cf66" stroke-width="2"/>
                            <text x="505" y="200" text-anchor="middle" fill="#51cf66" font-size="12" font-weight="bold">Topic: orders</text>
                            <!-- Particiones -->
                            <rect id="ordersP0" x="430" y="210" width="45" height="55" rx="4" fill="#1a1a1a" stroke="#51cf66" stroke-width="1"/>
                            <text x="452" y="227" text-anchor="middle" fill="#51cf66" font-size="9">P0</text>
                            <g id="ordersP0Messages" transform="translate(433, 235)"></g>

                            <rect id="ordersP1" x="480" y="210" width="45" height="55" rx="4" fill="#1a1a1a" stroke="#51cf66" stroke-width="1"/>
                            <text x="502" y="227" text-anchor="middle" fill="#51cf66" font-size="9">P1</text>
                            <g id="ordersP1Messages" transform="translate(483, 235)"></g>

                            <rect id="ordersP2" x="530" y="210" width="45" height="55" rx="4" fill="#1a1a1a" stroke="#51cf66" stroke-width="1"/>
                            <text x="552" y="227" text-anchor="middle" fill="#51cf66" font-size="9">P2</text>
                            <g id="ordersP2Messages" transform="translate(533, 235)"></g>
                        </g>

                        <!-- Topic: Payments -->
                        <g id="paymentsTopicGroup">
                            <rect x="610" y="180" width="170" height="100" rx="8" fill="#3a3a3a" stroke="#4dabf7" stroke-width="2"/>
                            <text x="695" y="200" text-anchor="middle" fill="#4dabf7" font-size="12" font-weight="bold">Topic: payments</text>
                            <!-- Particiones -->
                            <rect id="paymentsP0" x="620" y="210" width="45" height="55" rx="4" fill="#1a1a1a" stroke="#4dabf7" stroke-width="1"/>
                            <text x="642" y="227" text-anchor="middle" fill="#4dabf7" font-size="9">P0</text>
                            <g id="paymentsP0Messages" transform="translate(623, 235)"></g>

                            <rect id="paymentsP1" x="670" y="210" width="45" height="55" rx="4" fill="#1a1a1a" stroke="#4dabf7" stroke-width="1"/>
                            <text x="692" y="227" text-anchor="middle" fill="#4dabf7" font-size="9">P1</text>
                            <g id="paymentsP1Messages" transform="translate(673, 235)"></g>

                            <rect id="paymentsP2" x="720" y="210" width="45" height="55" rx="4" fill="#1a1a1a" stroke="#4dabf7" stroke-width="1"/>
                            <text x="742" y="227" text-anchor="middle" fill="#4dabf7" font-size="9">P2</text>
                            <g id="paymentsP2Messages" transform="translate(723, 235)"></g>
                        </g>

                        <!-- Topic: Shipping -->
                        <g id="shippingTopicGroup">
                            <rect x="420" y="295" width="170" height="100" rx="8" fill="#3a3a3a" stroke="#9775fa" stroke-width="2"/>
                            <text x="505" y="315" text-anchor="middle" fill="#9775fa" font-size="12" font-weight="bold">Topic: shipping</text>
                            <!-- Particiones -->
                            <rect id="shippingP0" x="430" y="325" width="45" height="55" rx="4" fill="#1a1a1a" stroke="#9775fa" stroke-width="1"/>
                            <text x="452" y="342" text-anchor="middle" fill="#9775fa" font-size="9">P0</text>
                            <g id="shippingP0Messages" transform="translate(433, 350)"></g>

                            <rect id="shippingP1" x="480" y="325" width="45" height="55" rx="4" fill="#1a1a1a" stroke="#9775fa" stroke-width="1"/>
                            <text x="502" y="342" text-anchor="middle" fill="#9775fa" font-size="9">P1</text>
                            <g id="shippingP1Messages" transform="translate(483, 350)"></g>

                            <rect id="shippingP2" x="530" y="325" width="45" height="55" rx="4" fill="#1a1a1a" stroke="#9775fa" stroke-width="1"/>
                            <text x="552" y="342" text-anchor="middle" fill="#9775fa" font-size="9">P2</text>
                            <g id="shippingP2Messages" transform="translate(533, 350)"></g>
                        </g>

                        <!-- Topic: Notifications -->
                        <g id="notificationsTopicGroup">
                            <rect x="610" y="295" width="170" height="100" rx="8" fill="#3a3a3a" stroke="#ff8787" stroke-width="2"/>
                            <text x="695" y="315" text-anchor="middle" fill="#ff8787" font-size="12" font-weight="bold">Topic: notifications</text>
                            <!-- Particiones -->
                            <rect id="notificationsP0" x="620" y="325" width="45" height="55" rx="4" fill="#1a1a1a" stroke="#ff8787" stroke-width="1"/>
                            <text x="642" y="342" text-anchor="middle" fill="#ff8787" font-size="9">P0</text>
                            <g id="notificationsP0Messages" transform="translate(623, 350)"></g>

                            <rect id="notificationsP1" x="670" y="325" width="45" height="55" rx="4" fill="#1a1a1a" stroke="#ff8787" stroke-width="1"/>
                            <text x="692" y="342" text-anchor="middle" fill="#ff8787" font-size="9">P1</text>
                            <g id="notificationsP1Messages" transform="translate(673, 350)"></g>

                            <rect id="notificationsP2" x="720" y="325" width="45" height="55" rx="4" fill="#1a1a1a" stroke="#ff8787" stroke-width="1"/>
                            <text x="742" y="342" text-anchor="middle" fill="#ff8787" font-size="9">P2</text>
                            <g id="notificationsP2Messages" transform="translate(723, 350)"></g>
                        </g>
                    </g>

                    <!-- Microservicios Consumidores -->
                    <!-- Inventario Microservice -->
                    <g id="inventoryService" filter="url(#shadow)">
                        <rect x="30" y="480" width="180" height="120" rx="15" fill="url(#gradInventory)" stroke="white" stroke-width="3"/>
                        <circle cx="120" cy="515" r="25" fill="white" opacity="0.2"/>
                        <text x="120" y="525" text-anchor="middle" font-size="30">üì¶</text>
                        <text x="120" y="555" text-anchor="middle" fill="white" font-size="15" font-weight="bold">Inventory Service</text>
                        <rect x="45" y="570" width="150" height="20" rx="10" fill="rgba(0,0,0,0.2)"/>
                        <text x="120" y="584" text-anchor="middle" fill="white" font-size="10" opacity="0.8">inventory-group</text>
                        <text x="120" y="597" text-anchor="middle" fill="#ffd700" font-size="12" font-weight="bold" id="inventoryCount">0 msgs</text>
                    </g>

                    <!-- Pagos Microservice -->
                    <g id="paymentService" filter="url(#shadow)">
                        <rect x="240" y="480" width="180" height="120" rx="15" fill="url(#gradPayment)" stroke="white" stroke-width="3"/>
                        <circle cx="330" cy="515" r="25" fill="white" opacity="0.2"/>
                        <text x="330" y="525" text-anchor="middle" font-size="30">üí≥</text>
                        <text x="330" y="555" text-anchor="middle" fill="white" font-size="15" font-weight="bold">Payment Service</text>
                        <rect x="255" y="570" width="150" height="20" rx="10" fill="rgba(0,0,0,0.2)"/>
                        <text x="330" y="584" text-anchor="middle" fill="white" font-size="10" opacity="0.8">payment-group</text>
                        <text x="330" y="597" text-anchor="middle" fill="#ffd700" font-size="12" font-weight="bold" id="paymentCount">0 msgs</text>
                    </g>

                    <!-- Env√≠os Microservice -->
                    <g id="shippingService" filter="url(#shadow)">
                        <rect x="780" y="480" width="180" height="120" rx="15" fill="url(#gradShipping)" stroke="white" stroke-width="3"/>
                        <circle cx="870" cy="515" r="25" fill="white" opacity="0.2"/>
                        <text x="870" y="525" text-anchor="middle" font-size="30">üöö</text>
                        <text x="870" y="555" text-anchor="middle" fill="white" font-size="15" font-weight="bold">Shipping Service</text>
                        <rect x="795" y="570" width="150" height="20" rx="10" fill="rgba(0,0,0,0.2)"/>
                        <text x="870" y="584" text-anchor="middle" fill="white" font-size="10" opacity="0.8">shipping-group</text>
                        <text x="870" y="597" text-anchor="middle" fill="#ffd700" font-size="12" font-weight="bold" id="shippingCount">0 msgs</text>
                    </g>

                    <!-- Notificaciones Microservice -->
                    <g id="notificationService" filter="url(#shadow)">
                        <rect x="990" y="480" width="180" height="120" rx="15" fill="url(#gradNotification)" stroke="white" stroke-width="3"/>
                        <circle cx="1080" cy="515" r="25" fill="white" opacity="0.2"/>
                        <text x="1080" y="525" text-anchor="middle" font-size="30">üìß</text>
                        <text x="1080" y="555" text-anchor="middle" fill="white" font-size="15" font-weight="bold">Notification Service</text>
                        <rect x="1005" y="570" width="150" height="20" rx="10" fill="rgba(0,0,0,0.2)"/>
                        <text x="1080" y="584" text-anchor="middle" fill="white" font-size="10" opacity="0.8">notif-group</text>
                        <text x="1080" y="597" text-anchor="middle" fill="#ffd700" font-size="12" font-weight="bold" id="notificationCount">0 msgs</text>
                    </g>

                    <!-- Conexiones para Orquestaci√≥n -->
                    <g id="orchestrationConnections">
                        <line x1="600" y1="95" x2="600" y2="130" stroke="#999" stroke-width="2" marker-end="url(#arrowhead)" opacity="0.5"/>
                        <line x1="505" y1="280" x2="120" y2="480" stroke="#51cf66" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)" opacity="0.3"/>
                        <line x1="695" y1="280" x2="330" y2="480" stroke="#4dabf7" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)" opacity="0.3"/>
                        <line x1="505" y1="395" x2="870" y2="480" stroke="#9775fa" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)" opacity="0.3"/>
                        <line x1="695" y1="395" x2="1080" y2="480" stroke="#ff8787" stroke-width="2" stroke-dasharray="5,5" marker-end="url(#arrowhead)" opacity="0.3"/>

                        <!-- Leyenda de Orquestaci√≥n -->
                        <g id="orchestrationLegend">
                            <rect x="850" y="20" width="330" height="90" rx="10" fill="white" stroke="#ff6b6b" stroke-width="3" opacity="0.95"/>
                            <text x="1015" y="42" text-anchor="middle" fill="#c92a2a" font-size="14" font-weight="bold">üéØ Orquestaci√≥n</text>
                            <text x="870" y="62" fill="#333" font-size="11">‚Ä¢ Orquestador controla el flujo</text>
                            <text x="870" y="78" fill="#333" font-size="11">‚Ä¢ Servicios ejecutan √≥rdenes</text>
                            <text x="870" y="94" fill="#333" font-size="11">‚Ä¢ Coordinaci√≥n centralizada</text>
                        </g>
                    </g>

                    <!-- Conexiones para Coreograf√≠a (servicios se comunican entre s√≠) -->
                    <g id="choreographyConnections" style="display: none;">
                        <!-- Flujo principal con flechas bidireccionales m√°s visibles -->

                        <!-- Step 1: Inventario escucha de Orders y publica a Orders -->
                        <g id="step1">
                            <path d="M 505 280 L 120 480" stroke="#51cf66" stroke-width="3" fill="none" marker-end="url(#arrowheadBi)" opacity="0.6"/>
                            <rect x="280" y="350" width="180" height="50" rx="8" fill="white" stroke="#51cf66" stroke-width="2" opacity="0.95"/>
                            <text x="370" y="370" text-anchor="middle" fill="#2f9e44" font-size="11" font-weight="bold">‚ë† CONSUME: orders</text>
                            <text x="370" y="387" text-anchor="middle" fill="#2f9e44" font-size="10">CHECK_INVENTORY</text>
                        </g>

                        <!-- Step 2: Inventario publica INVENTORY_RESERVED a Orders -->
                        <path d="M 210 530 Q 350 450, 480 280" stroke="#51cf66" stroke-width="3" fill="none" marker-end="url(#arrowheadBi)" opacity="0.6" stroke-dasharray="8,4"/>
                        <rect x="280" y="420" width="180" height="40" rx="8" fill="#51cf66" stroke="#2f9e44" stroke-width="2" opacity="0.95"/>
                        <text x="370" y="438" text-anchor="middle" fill="white" font-size="10" font-weight="bold">‚ë° PUBLISH: orders</text>
                        <text x="370" y="453" text-anchor="middle" fill="white" font-size="9">INVENTORY_RESERVED</text>

                        <!-- Step 3: Pagos escucha INVENTORY_RESERVED de Orders -->
                        <path d="M 505 280 L 330 480" stroke="#4dabf7" stroke-width="3" fill="none" marker-end="url(#arrowheadBi)" opacity="0.6"/>
                        <rect x="380" y="350" width="180" height="50" rx="8" fill="white" stroke="#4dabf7" stroke-width="2" opacity="0.95"/>
                        <text x="470" y="370" text-anchor="middle" fill="#1971c2" font-size="11" font-weight="bold">‚ë¢ CONSUME: orders</text>
                        <text x="470" y="387" text-anchor="middle" fill="#1971c2" font-size="10">INVENTORY_RESERVED</text>

                        <!-- Step 4: Pagos publica a Payments -->
                        <path d="M 420 520 Q 580 400, 670 280" stroke="#4dabf7" stroke-width="3" fill="none" marker-end="url(#arrowheadBi)" opacity="0.6" stroke-dasharray="8,4"/>
                        <rect x="500" y="380" width="180" height="40" rx="8" fill="#4dabf7" stroke="#1971c2" stroke-width="2" opacity="0.95"/>
                        <text x="590" y="398" text-anchor="middle" fill="white" font-size="10" font-weight="bold">‚ë£ PUBLISH: payments</text>
                        <text x="590" y="413" text-anchor="middle" fill="white" font-size="9">PAYMENT_PROCESSED</text>

                        <!-- Step 5: Env√≠os escucha de Payments -->
                        <path d="M 695 280 L 870 480" stroke="#9775fa" stroke-width="3" fill="none" marker-end="url(#arrowheadBi)" opacity="0.6"/>
                        <rect x="730" y="350" width="180" height="50" rx="8" fill="white" stroke="#9775fa" stroke-width="2" opacity="0.95"/>
                        <text x="820" y="370" text-anchor="middle" fill="#6741d9" font-size="11" font-weight="bold">‚ë§ CONSUME: payments</text>
                        <text x="820" y="387" text-anchor="middle" fill="#6741d9" font-size="10">PAYMENT_PROCESSED</text>

                        <!-- Step 6: Env√≠os publica a Shipping -->
                        <path d="M 870 480 L 600 350" stroke="#9775fa" stroke-width="3" fill="none" marker-end="url(#arrowheadBi)" opacity="0.6" stroke-dasharray="8,4"/>
                        <rect x="680" y="410" width="180" height="40" rx="8" fill="#9775fa" stroke="#6741d9" stroke-width="2" opacity="0.95"/>
                        <text x="770" y="428" text-anchor="middle" fill="white" font-size="10" font-weight="bold">‚ë• PUBLISH: shipping</text>
                        <text x="770" y="443" text-anchor="middle" fill="white" font-size="9">SHIPPING_SCHEDULED</text>

                        <!-- Step 7: Notificaciones escucha de Notifications -->
                        <path d="M 695 395 L 1080 480" stroke="#ff8787" stroke-width="3" fill="none" marker-end="url(#arrowheadBi)" opacity="0.6"/>
                        <rect x="850" y="420" width="180" height="50" rx="8" fill="white" stroke="#ff8787" stroke-width="2" opacity="0.95"/>
                        <text x="940" y="440" text-anchor="middle" fill="#fa5252" font-size="11" font-weight="bold">‚ë¶ CONSUME: notifications</text>
                        <text x="940" y="457" text-anchor="middle" fill="#fa5252" font-size="10">ORDER_COMPLETED</text>

                        <!-- Leyenda de Coreograf√≠a -->
                        <g id="choreographyLegend">
                            <rect x="850" y="20" width="330" height="90" rx="10" fill="white" stroke="#667eea" stroke-width="3" opacity="0.95"/>
                            <text x="1015" y="42" text-anchor="middle" fill="#667eea" font-size="14" font-weight="bold">üíÉ Coreograf√≠a</text>
                            <text x="870" y="62" fill="#333" font-size="11">‚Ä¢ Cada servicio escucha eventos</text>
                            <text x="870" y="78" fill="#333" font-size="11">‚Ä¢ Cada servicio decide qu√© hacer</text>
                            <text x="870" y="94" fill="#333" font-size="11">‚Ä¢ Sin coordinador central</text>
                        </g>
                    </g>

                    <!-- Capa de animaciones (encima de todo) -->
                    <g id="animationLayer"></g>
                </svg>
            </div>
        </div>

        <div class="kafka-terminals">
            <!-- Terminal Producer -->
            <div class="terminal">
                <div class="terminal-header">
                    <div class="terminal-title">
                        <span>üì§</span>
                        <span>Kafka Producer</span>
                    </div>
                    <div class="terminal-buttons">
                        <div class="terminal-btn close"></div>
                        <div class="terminal-btn minimize"></div>
                        <div class="terminal-btn maximize"></div>
                        <button class="terminal-clear-btn" id="clearProducerBtn">cls</button>
                    </div>
                </div>
                <div class="terminal-content" id="producerTerminal">
                    <div class="terminal-line">
                        <span class="terminal-timestamp">[00:00:00]</span>
                        <span class="terminal-producer">‚ñ∂</span> Kafka Producer iniciado
                    </div>
                    <div class="terminal-line">
                        <span class="terminal-timestamp">[00:00:00]</span>
                        <span style="color: #858585;">‚îî‚îÄ Conectado a: localhost:9092</span>
                    </div>
                    <div class="terminal-line">
                        <span class="terminal-timestamp">[00:00:00]</span>
                        <span style="color: #858585;">‚îî‚îÄ Esperando mensajes...</span>
                    </div>
                </div>
            </div>

            <!-- Terminal Consumer -->
            <div class="terminal">
                <div class="terminal-header">
                    <div class="terminal-title">
                        <span>üì•</span>
                        <span>Kafka Consumer</span>
                    </div>
                    <div class="terminal-buttons">
                        <div class="terminal-btn close"></div>
                        <div class="terminal-btn minimize"></div>
                        <div class="terminal-btn maximize"></div>
                        <button class="terminal-clear-btn" id="clearConsumerBtn">cls</button>
                    </div>
                </div>
                <div class="terminal-content" id="consumerTerminal">
                    <div class="terminal-line">
                        <span class="terminal-timestamp">[00:00:00]</span>
                        <span class="terminal-consumer">‚óÄ</span> Kafka Consumer iniciado
                    </div>
                    <div class="terminal-line">
                        <span class="terminal-timestamp">[00:00:00]</span>
                        <span style="color: #858585;">‚îî‚îÄ Grupos: inventory-group, payment-group, shipping-group, notif-group</span>
                    </div>
                    <div class="terminal-line">
                        <span class="terminal-timestamp">[00:00:00]</span>
                        <span style="color: #858585;">‚îî‚îÄ Escuchando t√≥picos...</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin: 0;">üìä Registro de Eventos</h2>
                <button id="clearEventsBtn" style="padding: 8px 16px; font-size: 0.9em; background: linear-gradient(135deg, #ff6b6b 0%, #c92a2a 100%);">
                    üóëÔ∏è Limpiar
                </button>
            </div>
            <div class="event-log" id="eventLog"></div>
        </div>
    </div>

    <!-- Modal de Pantalla Completa -->
    <div id="fullscreenModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" id="closeModal">√ó</button>
            <h2 style="color: #667eea; text-align: center; margin-bottom: 20px;" id="modalTitle">üîÑ Arquitectura con Kafka - Vista Ampliada</h2>
            <svg id="modalDiagram" class="modal-svg" viewBox="0 0 1200 650">
                <!-- El contenido del SVG se clonar√° aqu√≠ -->
            </svg>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>